<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android,">










<meta name="description" content="Android 代码重构在实际开发中，我们经常会遇到所谓的&amp;quot;屎山&amp;quot;，我们经常写&amp;quot;屎山&amp;quot;,也经常在查看或者修改 的时候喷&amp;quot;屎山&amp;quot;的作者. 但是在想要在短时间内去完成需求，难看的代码还是很必要的。所以在开发过后，代码重构也总是必要的。所以我们还是需要掌握一些代码重构的方法和思路。 Android 代码重构要素我们想要对一段功能代码进行重构，我">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 代码重构 浅入初学">
<meta property="og:url" content="http://yoursite.com/2020/11/20/Android-代码重构-浅入初学/index.html">
<meta property="og:site_name" content="maybe96&#39;blog">
<meta property="og:description" content="Android 代码重构在实际开发中，我们经常会遇到所谓的&amp;quot;屎山&amp;quot;，我们经常写&amp;quot;屎山&amp;quot;,也经常在查看或者修改 的时候喷&amp;quot;屎山&amp;quot;的作者. 但是在想要在短时间内去完成需求，难看的代码还是很必要的。所以在开发过后，代码重构也总是必要的。所以我们还是需要掌握一些代码重构的方法和思路。 Android 代码重构要素我们想要对一段功能代码进行重构，我">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/20/DQDz0f.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/06/03/tUqgkq.jpg">
<meta property="og:image" content="https://s1.ax1x.com/2020/06/04/t0yq4H.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/06/04/t0yHED.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/06/04/tBkMjg.png">
<meta property="og:image" content="https://s3.ax1x.com/2020/11/21/D1gOje.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/08/21/dYfU2D.png">
<meta property="og:updated_time" content="2020-11-21T09:05:33.076Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 代码重构 浅入初学">
<meta name="twitter:description" content="Android 代码重构在实际开发中，我们经常会遇到所谓的&amp;quot;屎山&amp;quot;，我们经常写&amp;quot;屎山&amp;quot;,也经常在查看或者修改 的时候喷&amp;quot;屎山&amp;quot;的作者. 但是在想要在短时间内去完成需求，难看的代码还是很必要的。所以在开发过后，代码重构也总是必要的。所以我们还是需要掌握一些代码重构的方法和思路。 Android 代码重构要素我们想要对一段功能代码进行重构，我">
<meta name="twitter:image" content="https://s3.ax1x.com/2020/11/20/DQDz0f.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/11/20/Android-代码重构-浅入初学/">





  <title>Android 代码重构 浅入初学 | maybe96'blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">maybe96'blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/20/Android-代码重构-浅入初学/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="maybe96">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="maybe96'blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android 代码重构 浅入初学</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-20T10:31:38+08:00">
                2020-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Android-代码重构"><a href="#Android-代码重构" class="headerlink" title="Android 代码重构"></a>Android 代码重构</h1><pre><code>在实际开发中，我们经常会遇到所谓的&quot;屎山&quot;，我们经常写&quot;屎山&quot;,也经常在查看或者修改 的时候喷&quot;屎山&quot;的作者. 但是在想要在短时间内去完成需求，难看的代码还是很必要的。所以在开发过后，代码重构也总是必要的。所以我们还是需要掌握一些代码重构的方法和思路。
</code></pre><h2 id="Android-代码重构要素"><a href="#Android-代码重构要素" class="headerlink" title="Android 代码重构要素"></a>Android 代码重构要素</h2><p>我们想要对一段功能代码进行重构，我们首先要掌握重构的要素是什么？这样针对性的解决重构问题，将会省时省力</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>针对代码重构，优化肯定是很必要的。对于一段代码，不是说我们将他分解出去几个部分，就能降低圈复杂度，从而实现代码重构。这样有时候会事半功倍，将本来相对完整的代码，重构到支离破碎，<br>如何把握优化的方向以及优化的形式是很必要的。<br>这里我们重点提两个方向。</p>
<h3 id="优化方向——下沉逻辑"><a href="#优化方向——下沉逻辑" class="headerlink" title="优化方向——下沉逻辑"></a>优化方向——下沉逻辑</h3><p>我们针对一个从无到有的APP 从初期架构到后期架构需要经历的过程<br>首先我们需要在设计阶段就确立好架构</p>
<h4 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h4><h5 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h5><p>简单来说 就是将整个应用分为Model，view以及controller 三个部分</p>
<p>这个架构如果是针对相对简单的APP是可以接受的，但是当业务开始膨胀了之后，大量View的逻辑也写入Activity中，导致Activity 里面代码冗余严重，严重影响可读性。<br>所以也导致了MVP的架构出现</p>
<h5 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h5><p>将view层和Model 层的通信切断了，让persenter 代理处理view 操作model层的操作，当然Persenter 也会通过view暴露出来的接口 与view层进行通信</p>
<h5 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h5><p>其实跟MVP架构差不多，用ViewModel 取代了 persenter ，并将View和ViewModel 的通信使用Binding 进行通信，即 View中使用 DataBinding 进行数据绑定，即避免findViewById() 操作，减少Activity 中 view相关绑定代码。<br>以及使得View 和 ViewModel 开发和测试相对更独立</p>
<h5 id="Android-FluxJava-和-RxJava"><a href="#Android-FluxJava-和-RxJava" class="headerlink" title="Android FluxJava 和 RxJava"></a>Android FluxJava 和 RxJava</h5><p><a href="https://imgchr.com/i/DQDz0f" target="_blank" rel="noopener"><img src="https://s3.ax1x.com/2020/11/20/DQDz0f.png" alt="DQDz0f.png"></a><br>响应式编程<br>以后学习到了再补充</p>
<h4 id="下沉业务-框架优化"><a href="#下沉业务-框架优化" class="headerlink" title="下沉业务 框架优化"></a>下沉业务 框架优化</h4><p>在架构确立完成后，我们就开始了APP 的 从零到一的开发过程</p>
<p>当功能更加完善，业务逻辑逐渐复杂之后，我们还是会面临到一个问题，业务代码冗余，难懂，这时候就应该去逐步下沉业务，做到业务隔离。</p>
<p>下沉业务也会遇到三个问题，首先是Big Common，随着业务拆解越多，底层Common也变得逻辑复杂，代码增多，这个我们肯定不可以接受，其次是多模块间相互调用，你的业务模块是否通用，是否能满足多模块调用的普适性，最后是云端调用(即Be On Cloud)，你的模块是否能在其他的大的方向被别人调用，如果可以，能否做成组件化。</p>
<p>这里业务下沉我的建议是使用一些现成的框架去优化业务连接的操作，尽量少使用Intent.因为在显式intent的情况下，会存在直接的类依赖的问题，导致耦合非常严重；而在隐式intent情况下，则会出现规则集中式管理，导致协作变得非常困难。</p>
<p>这里可以去学习一下 ARouter 阿里开源的 Android 路由中间件，可以使用url进行跳转，并且自动注入参数，添加拦截器和拦截顺序,提供切面编程。。。。<br>这里简单的提供一下如何实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">// 在支持ARouter的Activity上加注解（至少两级）</span><br><span class="line">@Route(path = &quot;/test/test1&quot;)</span><br><span class="line">public class TestActivity extend Activity &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">@Route(path = &quot;/test/1&quot;)</span><br><span class="line">public class YourActivity extend Activity &#123;</span><br><span class="line">    //获取数据三种方式</span><br><span class="line">    //1.通过Autowired注解表明key   &amp;  需要在onCreate中调用ARouter.getInstance().inject(this);配合使用</span><br><span class="line">    @Autowired(name = &quot;key1&quot;)</span><br><span class="line">    public long data;</span><br><span class="line">    //2.通过Autowired注解 &amp; 将key1作为属性的名称   &amp;  需要在onCreate中调用ARouter.getInstance().inject(this);配合使用</span><br><span class="line">    @Autowired()</span><br><span class="line">    public long key1;</span><br><span class="line">    //3.通过Bundle获取</span><br><span class="line">    getIntent().getExtras().getLong(&quot;key1&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//跳转操作（Intent）</span><br><span class="line">ARouter.getInstance().build(&quot;/test/1&quot;)</span><br><span class="line">            .withLong(&quot;key1&quot;, 666L)</span><br><span class="line">            .withString(&quot;key3&quot;, &quot;888&quot;)</span><br><span class="line">            .withSerializable(&quot;key4&quot;, new Test(&quot;Jack&quot;, &quot;Rose&quot;))</span><br><span class="line">            .navigation();</span><br><span class="line"></span><br><span class="line"> // 拦截器会在跳转之间执行，多个拦截器会按优先级顺序依次执行</span><br><span class="line"> @Interceptor(priority = 666, name = &quot;测试用拦截器&quot;)</span><br><span class="line"> public class TestInterceptor implements IInterceptor &#123;</span><br><span class="line">     /**</span><br><span class="line">      * The operation of this interceptor.</span><br><span class="line">      *</span><br><span class="line">      * @param postcard meta</span><br><span class="line">      * @param callback cb</span><br><span class="line">      */</span><br><span class="line">     @Override</span><br><span class="line">     public void process(Postcard postcard, InterceptorCallback callback) &#123;</span><br><span class="line">         ...</span><br><span class="line"></span><br><span class="line">         callback.onContinue(postcard);  // 处理完成，交还控制权</span><br><span class="line">         // callback.onInterrupt(new RuntimeException(&quot;我觉得有点异常&quot;));      // 觉得有问题，中断路由流程</span><br><span class="line"></span><br><span class="line">         // 以上两种至少需要调用其中一种，否则会超时跳过</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     /**</span><br><span class="line">      * Do your init work in this method, it well be call when processor has been load.</span><br><span class="line">      *</span><br><span class="line">      * @param context ctx</span><br><span class="line">      */</span><br><span class="line">     @Override</span><br><span class="line">     public void init(Context context) &#123;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="依赖注入-解耦"><a href="#依赖注入-解耦" class="headerlink" title="依赖注入 解耦"></a>依赖注入 解耦</h3><p>这个关注点很容易让人想到Spring 框架，如果Android 也有类似Spring框架的解耦框架，也能很好的重构（Spring For Android 虽然也有，但是公司里面就没用到过。。。。）</p>
<p>这里还是给没接触过Spring的同学，讲解一下依赖注入的原理<br>    依赖注入(Dependency Injection)和控制反转(Inversion of Control)是同一个概念。具体含义是:当某个角色(可能是一个Java实例，调用者)需要另一个角色(另一个Java实例，被调用者)的协助时，在 传统的程序设计过程中，通常由调用者来创建被调用者的实例。但在Spring里，创建被调用者的工作不再由调用者来完成，因此称为控制反转;创建被调用者 实例的工作通常由Spring容器来完成，然后注入调用者，因此也称为依赖注入。<br>其实针对上面的架构设计，依赖注入其实就是MVP架构的变形优化了。<br>首先根据分层原则，将整个APP 的架构设计分为四层</p>
<ol>
<li>外层：事件引导层（View） 主要负责View事件上的走向，例如onClick、onTouch、onRefresh 等，将事件传递至业务逻辑层</li>
<li>中间件：接口适配层 主要负责连接业务逻辑和框架特定代码，担任业务逻辑层和外层的通信</li>
<li>业务逻辑层 就是跟名字意思一样，负责处理复杂业务逻辑（并且应该能独立测试，开发，保证多人协作开发的高效性）</li>
<li>底层 Model层 ，实体层，通过接口适配层，给业务逻辑层提供实体的一些属性。。。</li>
</ol>
<p><strong>这样做有什么好处呢？</strong><br>很明显的是，将外层，业务逻辑层以及Model层隔离开了，通过接口适配层进行隔离，保证了多人协作开放，以及测试的高效性</p>
<p>并且在修改的时候，也可以通过切面编程以及注入去修改代码，避免修改外层代码</p>
<h4 id="Dagger2-框架"><a href="#Dagger2-框架" class="headerlink" title="Dagger2 框架"></a>Dagger2 框架</h4><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>首先有一个比喻很形象，Dagger 进行依赖注入相当于注射药物，@Inject 就是 注射的部位，@Component 就是 这个注射器 而 @Moudle 则是 注射瓶 用来存放药水，最后@Providers 就是 药水。</p>
<p>@Inject 标识依赖需求方 （也可以写在注入对象的无参构造函数上，但是无法使用在接口，有参构造函数，第三方类库上面)</p>
<p>@Providers 标识依赖提供方。</p>
<p>@Moudle 存放@Providers 的地方，只提供依赖关系，不反应真实的依赖，它会告诉Dagger 可以从哪里找到依赖。</p>
<p>（Moudle里面的Porviders 可能会和 @Inject 标识的 无参构造函数冲突 这时候 会优先扫描Moudle 里面的注入方法，而不是@Inject）</p>
<p>@Component 依赖需求方和依赖提供方进行交互的桥梁接口，</p>
<h4 id="实例讲解用法"><a href="#实例讲解用法" class="headerlink" title="实例讲解用法"></a>实例讲解用法</h4><p><a href="https://imgchr.com/i/tUqgkq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/06/03/tUqgkq.jpg" alt="tUqgkq.jpg"></a></p>
<p>针对一个RandomUserSAPI 我们需要去使用OKhttp，Retrofit，以及Gson等<br>如果我们在OnCreate里面加载初始化应该怎么做？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line"></span><br><span class="line">OkHttpClient client = new OkHttpClient();</span><br><span class="line"></span><br><span class="line">// Enable caching for OkHttp</span><br><span class="line">int cacheSize = 10 * 1024 * 1024; // 10 MiB</span><br><span class="line">Cache cache = new Cache(getApplication().getCacheDir(), cacheSize);</span><br><span class="line">client.setCache(cache);</span><br><span class="line"></span><br><span class="line">// Used for caching authentication tokens</span><br><span class="line">SharedPreferences sharedPrefeences = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line"></span><br><span class="line">// Instantiate Gson</span><br><span class="line">Gson gson = new GsonBuilder().create();</span><br><span class="line">GsonConverterFactory converterFactory = GsonConverterFactory.create(Gson);</span><br><span class="line"></span><br><span class="line">// Build Retrofit</span><br><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                                .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">                                .addConverterFactory(converterFactory)</span><br><span class="line">                                .client(client)  // custom client</span><br><span class="line">                                .build();</span><br><span class="line"></span><br><span class="line">public void onCreate(Bundle savedInstance) &#123;</span><br><span class="line">    retrofit.xxx();</span><br><span class="line">    sharedPrefeences.xxx();</span><br><span class="line">    gson.xxx()</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>这样写会有什么问题？</strong></p>
<p>复杂，冗余，耦合性差</p>
<p>那我们可以使用Dagger2 去进行依赖注入，从而解耦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//Module 是存放药水的地方</span><br><span class="line">//Provides是存放的药水</span><br><span class="line">@Module</span><br><span class="line">public class NetModule &#123;</span><br><span class="line"></span><br><span class="line">    String mBaseUrl;</span><br><span class="line"></span><br><span class="line">    // Constructor needs one parameter to instantiate.  </span><br><span class="line">    public NetModule(String baseUrl) &#123;</span><br><span class="line">        this.mBaseUrl = baseUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Dagger will only look for methods annotated with @Provides</span><br><span class="line">    @Provides</span><br><span class="line">    @Singleton</span><br><span class="line">    // Application reference must come from AppModule.class</span><br><span class="line">    SharedPreferences providesSharedPreferences(Application application) &#123;</span><br><span class="line">        return PreferenceManager.getDefaultSharedPreferences(application);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Provides</span><br><span class="line">    @Singleton</span><br><span class="line">    Cache provideOkHttpCache(Application application) &#123; </span><br><span class="line">        int cacheSize = 10 * 1024 * 1024; // 10 MiB</span><br><span class="line">        Cache cache = new Cache(application.getCacheDir(), cacheSize);</span><br><span class="line">        return cache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   @Provides </span><br><span class="line">   @Singleton</span><br><span class="line">   Gson provideGson() &#123;  </span><br><span class="line">       GsonBuilder gsonBuilder = new GsonBuilder();</span><br><span class="line">       gsonBuilder.setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES);</span><br><span class="line">       return gsonBuilder.create();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Provides</span><br><span class="line">   @Singleton</span><br><span class="line">   OkHttpClient provideOkHttpClient(Cache cache) &#123;</span><br><span class="line">      OkHttpClient client = new OkHttpClient();</span><br><span class="line">      client.setCache(cache);</span><br><span class="line">      return client;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Provides</span><br><span class="line">   @Singleton</span><br><span class="line">   Retrofit provideRetrofit(Gson gson, OkHttpClient okHttpClient) &#123;</span><br><span class="line">      Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create(gson))</span><br><span class="line">                .baseUrl(mBaseUrl)</span><br><span class="line">                .client(okHttpClient)</span><br><span class="line">                .build();</span><br><span class="line">        return retrofit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//Inject 表示注入点</span><br><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">   @Inject MyTwitterApiClient mTwitterApiClient;</span><br><span class="line">   @Inject SharedPreferences sharedPreferences;</span><br><span class="line"></span><br><span class="line">  public void onCreate(Bundle savedInstance) &#123;</span><br><span class="line">       // assign singleton instances to fields</span><br><span class="line">       InjectorClass.inject(this);</span><br><span class="line">   &#125; </span><br><span class="line"></span><br><span class="line">// Component 则是表示注射器，搭建好Inject和Module 之间的桥梁</span><br><span class="line">@Singleton</span><br><span class="line">@Component(modules=&#123;AppModule.class, NetModule.class&#125;)</span><br><span class="line">public interface NetComponent &#123;</span><br><span class="line">   void inject(MainActivity activity);</span><br><span class="line">   // void inject(MyFragment fragment);</span><br><span class="line">   // void inject(MyService service);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="真实场景下重构"><a href="#真实场景下重构" class="headerlink" title="真实场景下重构"></a>真实场景下重构</h3><p><strong>初始化注册服务逻辑</strong></p>
<p><a href="https://imgchr.com/i/t0yq4H" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/06/04/t0yq4H.png" alt="t0yq4H.png"></a></p>
<p><a href="https://imgchr.com/i/t0yHED" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/06/04/t0yHED.png" alt="t0yHED.png"></a></p>
<p><strong>降低圈复杂度</strong><br><a href="https://imgchr.com/i/tBkMjg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/06/04/tBkMjg.png" alt="tBkMjg.png"></a></p>
<h2 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h2><p>在重构需求的开发中，我们不仅需要保证重构的一些圈复杂度，一些下沉业务的通用性等因素之外，更为重要的是我要确保之前开发的所有功能都必须要正常运行，不出错。</p>
<p><strong>如何保证可靠性呢？</strong></p>
<h3 id="自动化测试框架"><a href="#自动化测试框架" class="headerlink" title="自动化测试框架"></a>自动化测试框架</h3><h4 id="Mockito-和spy-的异同"><a href="#Mockito-和spy-的异同" class="headerlink" title="Mockito 和spy 的异同"></a>Mockito 和spy 的异同</h4><p><a href="https://imgchr.com/i/D1gOje" target="_blank" rel="noopener"><img src="https://s3.ax1x.com/2020/11/21/D1gOje.png" alt="D1gOje.png"></a></p>
<h4 id="验证某个方法的调用情况"><a href="#验证某个方法的调用情况" class="headerlink" title="验证某个方法的调用情况"></a>验证某个方法的调用情况</h4><ul>
<li>验证某个方法是否被调用        verify(…)</li>
<li>验证某个方法调用次数        times(…)</li>
<li>验证某个方法参数值        ArgumentCaptor</li>
</ul>
<h4 id="自定义某个方法的行为"><a href="#自定义某个方法的行为" class="headerlink" title="自定义某个方法的行为"></a>自定义某个方法的行为</h4><ul>
<li>调用某个方法后返回指定值     doReturn(…)when(…)</li>
<li>同上，且可以拿到入参         doAnswer(…)when(…)</li>
<li>调用某个void方法后什么也不做  doNothing(…)when(…)</li>
<li>调用某个方法后执行原方法调用     doCallRealMethod (…)when(…)</li>
<li>调用某个方法后抛出异常         doThrow(…)when(…)</li>
</ul>
<h3 id="Hook组件-amp-热修复框架"><a href="#Hook组件-amp-热修复框架" class="headerlink" title="Hook组件 &amp; 热修复框架"></a>Hook组件 &amp; 热修复框架</h3><h4 id="Java-Hook"><a href="#Java-Hook" class="headerlink" title="Java Hook"></a>Java Hook</h4><p>java hook史就是一部跟art对抗的历史</p>
<p><a href="https://imgchr.com/i/dYfU2D" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/08/21/dYfU2D.png" alt="dYfU2D.png"></a></p>
<ol>
<li><p>dexposed / andfix</p>
<p> 通过将java方法修改为native方法，并将其指向hook的目标方法</p>
<ul>
<li><p>随着art不断升级，兼容性问题越来越多，目前已经不维护了</p>
</li>
<li><p>dalvik下实现简单，稳定性较高</p>
</li>
<li><p>变种YAHFA，会通过清空方法hotness_count_解决内联问题</p>
<p>参考：<a href="http://rk700.github.io/2017/06/30/hook-on-android-n/" target="_blank" rel="noopener">http://rk700.github.io/2017/06/30/hook-on-android-n/</a></p>
</li>
</ul>
</li>
<li><p>epic</p>
<p> 与后面要讲的inline hook类似，把被hook方法的前几个指令替换成跳板指令，跳到目标方法中执行，最后再执行被替换的指令</p>
<ul>
<li><p>实现复杂，需要保存/恢复寄存器、指令等等</p>
</li>
<li><p>兼容性问题多，不同cpu架构、机型、系统版本可能都有不同的问题需要处理</p>
</li>
<li><p>存在WeakGlobalRef泄漏问题</p>
</li>
<li><p>作者已不维护</p>
</li>
</ul>
</li>
</ol>
<pre><code>  参考：http://weishu.me/2017/11/23/dexposed-on-art/
</code></pre><ol>
<li><p>JVMTI</p>
<p>虚拟机提供的native编程接口，支持以下能力：</p>
<ul>
<li>方法进入/退出回调</li>
<li>获取方法入参/出参</li>
<li>修改方法入参</li>
<li>修改方法出参（android r）</li>
<li>修改类</li>
</ul>
<p>优劣势如下：</p>
<ul>
<li><p>实现起来稍复杂，需要ndk开发，并调用大量系统接口才能实现简单功能</p>
</li>
<li><p>对系统版本有要求</p>
</li>
<li><p>要求debug版本，但可以突破</p>
</li>
<li><p>功能强大</p>
</li>
<li><p>稳定性好</p>
</li>
</ul>
</li>
</ol>
<pre><code> 参考：https://git.code.oa.com/hongpingwu/cucu
</code></pre><ol>
<li><p>jni hook<br> java方法指针和它对应的native方法指针在虚拟机上的内存地址有固定的offset间隔，那么只要找到这个offset，加上java方法的地址就能够替换native方法所指向的地址</p>
<ul>
<li>只能hook java里定义的native方法</li>
<li>稳定</li>
</ul>
</li>
</ol>
<h4 id="native-hook"><a href="#native-hook" class="headerlink" title="native hook"></a>native hook</h4><ol>
<li><p>GOT hook<br> 通过自行解析elf文件格式，拿到got表在内存中的偏移，并根据so文件在/proc/self/maps中的内存位置确认got表的地址，最后查找目标函数got表里的入口地址并替换。导入表hook的最佳时机一般是load so的时候，可以配合jni hook，劫持System.load这个jni方法来hook目标函数。</p>
<ul>
<li>只能hook导入/导出的函数</li>
<li>稳定性相对较好</li>
<li>目前手q hook malloc/free，用来监控大内存申请和短时间内多次申请内存等可疑行为</li>
<li>微信 Matrix 开源库的ELF Hook，，主要使用它来做性能监控。爱奇艺开源的的xHoo,以及Facebook 的PLT Hook，等都是封装GOT Hook。</li>
</ul>
</li>
<li><p>inline hook<br> 可以hook绝大部分函数</p>
<ul>
<li><p>实现复杂、较短的函数无法hook、兼容性差在运行的流程中插入跳转指令（B、BL、BX、BLX），需要保存/恢复寄存器、指令等操作</p>
</li>
<li><p>在运行的流程中插入跳转指令（B、BL、BX、BLX），需要保存/恢复寄存器、指令等操作</p>
</li>
</ul>
</li>
</ol>
<pre><code>  参考：https://github.com/ele7enxxh/Android-Inline-Hook
</code></pre><ol>
<li><p>LD_PRELOAD</p>
<p> 特殊的环境变量，用于so加载，优先级最高。例如ASAN就能通过android 8.1开始支持的wrap shell script技术，在wrap.sh脚本中指定LD_PRELOAD环境变量加载ASAN的malloc相关库，实现对这类函数的hook。</p>
<ul>
<li><p>8.1以上才支持，且仅限debug版</p>
</li>
<li><p>系统提供支持，理论上稳定可靠，但实际上有部分厂商却没有支持，比如一加</p>
</li>
</ul>
</li>
</ol>
<ol>
<li><p>JNIEnv劫持</p>
<p> 通过替换JNIEnv定义的函数指针变量来实现hook jni提供的一系列接口。用于jni引用泄漏监控、jni参数错误监控、线程创建监控等等</p>
<ul>
<li><p>只能hook JNIEnv定义的函数</p>
</li>
<li><p>稳定性好，在手q上已稳定运行多年</p>
</li>
</ul>
</li>
<li><p>trap hook</p>
<p> 注册sigaction，在需要hook的地方写入触发信号量指令，接收到信号的时候执行目标函数，最后回写原始指令恢复现场。一般常用的是SIGTRAP或SIGKILL。但在android上暂时没听说过哪个app运用这种技术。</p>
<ul>
<li>兼容性好</li>
<li>效率低，触发信号的时候涉及到用户态/内核态切换</li>
</ul>
</li>
<li><p>dlfcn</p>
<p> android N开始对dlopen有命名空间限制，应用层无法dlopen系统so。重新造了一个dlopen、dlsym的轮子，通过分析elf文件找到函数的地址。严格上来说不太算是hook工具，类似java的反射。</p>
<ul>
<li><p>只能调用导出的函数</p>
</li>
<li><p>只能调用已经加载到内存的函数</p>
</li>
<li><p>稳定性较好，作为手q的补丁底层组件已经稳定运行多个版本</p>
</li>
</ul>
</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/11/20/Dagger2-深入学习/" rel="next" title>
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">maybe96</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-代码重构"><span class="nav-number">1.</span> <span class="nav-text">Android 代码重构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-代码重构要素"><span class="nav-number">1.1.</span> <span class="nav-text">Android 代码重构要素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化"><span class="nav-number">1.2.</span> <span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优化方向——下沉逻辑"><span class="nav-number">1.2.1.</span> <span class="nav-text">优化方向——下沉逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#架构设计"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MVC"><span class="nav-number">1.2.1.1.1.</span> <span class="nav-text">MVC</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MVP"><span class="nav-number">1.2.1.1.2.</span> <span class="nav-text">MVP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MVVM"><span class="nav-number">1.2.1.1.3.</span> <span class="nav-text">MVVM</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Android-FluxJava-和-RxJava"><span class="nav-number">1.2.1.1.4.</span> <span class="nav-text">Android FluxJava 和 RxJava</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下沉业务-框架优化"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">下沉业务 框架优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖注入-解耦"><span class="nav-number">1.2.2.</span> <span class="nav-text">依赖注入 解耦</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dagger2-框架"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">Dagger2 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原理"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例讲解用法"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">实例讲解用法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#真实场景下重构"><span class="nav-number">1.2.3.</span> <span class="nav-text">真实场景下重构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可靠性"><span class="nav-number">1.3.</span> <span class="nav-text">可靠性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自动化测试框架"><span class="nav-number">1.3.1.</span> <span class="nav-text">自动化测试框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mockito-和spy-的异同"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">Mockito 和spy 的异同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#验证某个方法的调用情况"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">验证某个方法的调用情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义某个方法的行为"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">自定义某个方法的行为</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook组件-amp-热修复框架"><span class="nav-number">1.3.2.</span> <span class="nav-text">Hook组件 &amp; 热修复框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Java-Hook"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">Java Hook</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#native-hook"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">native hook</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">maybe96</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
